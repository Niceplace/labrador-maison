services:
  app:
    image: fireflyiii/core:latest@sha256:db1f8eb2203a1d13af0bff1992b0c6b0304c8462074b552eced355e2329ed9f6
    container_name: firefly-iii
    restart: unless-stopped
    volumes:
      - ./upload:/var/www/html/storage/upload
    env_file:
      - .env
    networks:
      - thinknetwork
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.firefly.rule=Host(`firefly.thinkcenter.dev`)"
      - "traefik.http.routers.firefly.entrypoints=websecure"
      - "traefik.http.services.firefly.loadbalancer.server.port=8080"
    depends_on:
      - db

  db:
    image: mariadb:lts@sha256:345fa26d595e8c7fe298e0c4098ed400356f502458769c8902229b3437d6da2b
    container_name: firefly-db
    restart: unless-stopped
    volumes:
      - ./db:/var/lib/mysql
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_USER=firefly
      - MYSQL_PASSWORD=firefly_password
      - MYSQL_DATABASE=firefly
    networks:
      - thinknetwork

networks:
  thinknetwork:
    external: true
